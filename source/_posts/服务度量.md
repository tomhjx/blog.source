---
title: 服务度量
categories:
  - 运维
  - 度量
tags:
  - 度量
date: 2021-04-18 10:24:01
---

# RT

响应时间（response time 简称 RT）是从系统接收请求开始到返回响应之间的时间跨度，是一项极其重要的性能指标。它可以从侧面反映系统的整体吞吐量，也是业务请求（比如 sql 请求）的性能好坏的判断依据。

举个例子 A 要从杭州坐飞机到北京机场，经历如下：

```
从公司到萧山机场 40min
```

复制代码

其中真正的 ‘执行’ 时间就飞机飞行的时间（100min+40+40），其他安检、候机、堵车的都是等待时间。

> RT = 等待时间 + 执行时间

假如到机场的过程中发生堵车，或者空中管制导致候机时间延长，整体的 RT 也会变长，但是飞机飞行时间是相对一定的。

从技术的角度来看 SQL 的请求路径：

> app <\-\-\-\->（网络建立连接，data 传输）<\-\-\-\-> proxy <\-\-\-\->（网络建立连接，data 传输）<\-\-\-\-> mysql（执行）

因为网络问题丢包，重传等导致数据传输时间增加，进而导致总体的 RT 时间增加 ，还有常见的案例 app 服务器 cpu 飙高导致程序执行的速度变慢，JAVA 程序 GC 等因素也会导致 RT 升高。所以说 SQL 慢，其实 RT 就会高。但是反过来 **RT 高，不一定是 SQL 慢的原因** 。如果是开发同学遇到监控尤其是 trace 系统发现某个接口慢了，并不一定是 SQL 慢。

> 重点： **不要把 trace 系统中的监控 rt 直接当做 db 的执行时间**

参考案例：[Strace 解决性能问题案例一则](https://mp.weixin.qq.com/s?__biz=MzI4NjExMDA4NQ==&mid=2648450714&idx=1&sn=d2a25d111c78147001aa9329dbbf9dbd&scene=21#wechat_redirect)


# QPS

每秒请求数


# 并发量

我们首先分析一个问题：一个公司有7200名员工，每天上班打卡时间是早上8点到8点30分，每次打卡时间系统耗时5秒。请问RT、QPS、并发量分别是多少？

RT表示响应时间，问题已经告诉了我们答案：

> RT = 5

QPS表示每秒查询量，假设签到行为平均分布：

> QPS = 7200 / (30 \* 60) = 4

并发量表示系统同时处理的请求数量：

> 并发量 = QPS x RT = 4 x 5 = 20

根据上述实例引出如下公式：

> 并发量 = QPS x RT

如果系统为每一个请求分配一个处理线程，那么并发量可以近似等于线程数。基于上述公式不难看出并发量受QPS和RT影响，这两个指标任意一个上升就会导致并发量上升。

但是这只是理想情况，因为并发量受限于系统能力而不可能持续上升