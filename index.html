<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="疯狂的茶几, tomhjx" />





  <link rel="alternate" href="/atom.xml" title="疯狂的茶几" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="懒人一个">
<meta property="og:type" content="website">
<meta property="og:title" content="疯狂的茶几">
<meta property="og:url" content="http://tomhjx.github.io/index.html">
<meta property="og:site_name" content="疯狂的茶几">
<meta property="og:description" content="懒人一个">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="疯狂的茶几">
<meta name="twitter:description" content="懒人一个">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> 疯狂的茶几 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">疯狂的茶几</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
    <div class="site-search">
      
  
  <form class="site-search-form">
    <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
  </form>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'FswkeQpoefr-Zu6Swa1J','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    
      
      
        
        
        
      

      
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/25/nignx缓存proxy-cache/" itemprop="url">
                  nignx缓存proxy_cache
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-07-25T00:01:02+08:00" content="2016-07-25">
              2016-07-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/web服务器/" itemprop="url" rel="index">
                    <span itemprop="name">web服务器</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/web服务器/nignx/" itemprop="url" rel="index">
                    <span itemprop="name">nignx</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/25/nignx缓存proxy-cache/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/25/nignx缓存proxy-cache/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#10;ssh root@192.168.1.123 -p 32200&#10;&#10;vi /usr/local/nginx/conf/nginx.conf&#10;&#10;&#10;======&#10;&#10;user  www www;&#10;worker_processes  1;&#10;pid        logs/nginx.pid;&#10;&#10;events &#123;&#10;    worker_connections  1024;&#10;&#125;&#10;&#10;&#10;http &#123;&#10;    include       mime.types;&#10;    default_type  application/octet-stream;&#10;&#10;    log_format  main  &#39;$remote_addr\t$msec\t[$time_local]\t$request\t&#39;&#10;                     &#39;&#34;$status&#34;\t$body_bytes_sent\t&#34;$http_referer&#34;\t&#39;&#10;                     &#39;&#34;$http_user_agent&#34;\t&#34;$http_q_ua&#34;\t&#34;$http_x_forwarded_for&#34;\t&#39;&#10;                     &#39;&#34;$upstream_addr&#34;\t$request_time&#39;;&#10;&#10;    sendfile        on;&#10;    keepalive_timeout  65;&#10;&#10;    server &#123;&#10;        listen 80;&#10;        server_name dev123.demo.com dev123.demo.proxy.com;&#10;        access_log  logs/dev123.demo.com-access.log;&#10;        location / &#123;&#10;            root   /var/www/demo;&#10;            index  index.html index.htm;&#10;        &#125;&#10;&#10;        location ~ \.php$ &#123;&#10;            root   /var/www/demo;&#10;            fastcgi_pass   127.0.0.1:9000;&#10;            fastcgi_index  index.php;&#10;            fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;&#10;            include        fastcgi_params;&#10;        &#125;&#10;    &#125;&#10;&#10;&#125;&#10;&#10;======&#10;&#10;/etc/init.d/nginx reload&#10;&#10;&#10;ssh root@192.168.1.120 -p 32200&#10;&#10;vi /usr/local/nginx/conf/nginx.conf&#10;&#10;======&#10;&#10;user  www www;&#10;worker_processes  1;&#10;pid        logs/nginx.pid;&#10;&#10;events &#123;&#10;    worker_connections  1024;&#10;&#125;&#10;&#10;&#10;http &#123;&#10;    include       mime.types;&#10;    default_type  application/octet-stream;&#10;&#10;    log_format  main  &#39;$remote_addr\t$msec\t[$time_local]\t$request\t&#39;&#10;                     &#39;&#34;$status&#34;\t$body_bytes_sent\t&#34;$http_referer&#34;\t&#39;&#10;                     &#39;&#34;$http_user_agent&#34;\t&#34;$http_q_ua&#34;\t&#34;$http_x_forwarded_for&#34;\t&#39;&#10;                     &#39;&#34;$upstream_addr&#34;\t$request_time&#39;;&#10;&#10;    sendfile        on;&#10;    keepalive_timeout  65;&#10;    proxy_cache_path /usr/local/nginx/proxy_cache levels=1:2 keys_zone=my-cache:8m max_size=1000m inactive=600m;&#10;    proxy_temp_path /usr/local/nginx/proxy_temp;&#10;&#10;&#10;    upstream dev123 &#123;&#10;        server 192.168.1.123:80;&#10;    &#125;&#10;&#10;    server &#123;&#10;        listen 80;&#10;        server_name dev123.demo.proxy.com;&#10;        error_log  logs/dev123.demo.proxy.com-error.log;&#10;        access_log  logs/dev123.demo.proxy.com-access.log;&#10;&#10;        location / &#123;&#10;            proxy_pass http://dev123;&#10;            proxy_cache my-cache;&#10;            proxy_cache_valid 200 10m;&#10;            proxy_redirect off;&#10;            proxy_set_header Host $host;&#10;        &#125;&#10;    &#125;&#10;&#10;&#125;&#10;&#10;======&#10;&#10;/etc/init.d/nginx reload&#10;&#10;curl &#39;http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;curl &#39;http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;curl &#39;http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;curl &#39;http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;curl &#39;http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;curl -d &#39;&#39; http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;curl -d &#39;&#39; http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;curl -d &#39;&#39; http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;curl -d &#39;&#39; http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;curl -d &#39;&#39; http://dev123.demo.proxy.com/tmp/get-serv.php&#39;&#10;&#10;&#10;&#10;ssh root@192.168.1.123 -p 32200&#10;&#10;tail -n 10 /usr/local/nginx/logs/dev123.demo.com-access.log&#10;&#10;192.168.1.120 - - [24/Jul/2016:12:32:28 -0400] &#34;GET /tmp/get-serv.php HTTP/1.0&#34; 200 988 &#34;-&#34; &#34;curl/7.29.0&#34;&#10;192.168.1.120 - - [24/Jul/2016:12:33:03 -0400] &#34;POST /tmp/get-serv.php HTTP/1.0&#34; 200 1115 &#34;-&#34; &#34;curl/7.29.0&#34;&#10;192.168.1.120 - - [24/Jul/2016:12:33:03 -0400] &#34;POST /tmp/get-serv.php HTTP/1.0&#34; 200 1115 &#34;-&#34; &#34;curl/7.29.0&#34;&#10;192.168.1.120 - - [24/Jul/2016:12:33:04 -0400] &#34;POST /tmp/get-serv.php HTTP/1.0&#34; 200 1114 &#34;-&#34; &#34;curl/7.29.0&#34;&#10;192.168.1.120 - - [24/Jul/2016:12:33:06 -0400] &#34;POST /tmp/get-serv.php HTTP/1.0&#34; 200 1115 &#34;-&#34; &#34;curl/7.29.0&#34;&#10;192.168.1.120 - - [24/Jul/2016:12:33:07 -0400] &#34;POST /tmp/get-serv.php HTTP/1.0&#34; 200 1115 &#34;-&#34; &#34;curl/7.29.0&#34;</span><br></pre></td></tr></table></figure>
<p><a href="http://www.ttlsa.com/nginx/nginx-high-performance-caching/" target="_blank" rel="external">http://www.ttlsa.com/nginx/nginx-high-performance-caching/</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/04/Linux的inode是什么/" itemprop="url">
                  Linux的inode是什么
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-06-04T12:26:19+08:00" content="2016-06-04">
              2016-06-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/系统/" itemprop="url" rel="index">
                    <span itemprop="name">系统</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/系统/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/04/Linux的inode是什么/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/04/Linux的inode是什么/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>转自：<br><a href="http://www.ruanyifeng.com/blog/2011/12/inode.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2011/12/inode.html</a><br><a href="http://blog.s135.com/post/295/" target="_blank" rel="external">http://blog.s135.com/post/295/</a><br><a href="http://hi.baidu.com/leejun_2005/blog/item/d9aa13a53b3af6e99152ee7e.html" target="_blank" rel="external">http://hi.baidu.com/leejun_2005/blog/item/d9aa13a53b3af6e99152ee7e.html</a> </p>
<p>一、inode是什么？</p>
<p>理解inode，要从文件储存说起。<br>文件储存在硬盘上，硬盘的最小存储单位叫做”扇区”（Sector）。每个扇区储存512字节（相当于0.5KB）。</p>
<p>操作系统读取硬盘的时候，不会一个个扇区地读取，这样效率太低，而是一次性连续读取多个扇区，即一次性读取一个”块”（block）。这种由多个扇区组成的”块”，是文件存取的最小单位。”块”的大小，最常见的是4KB，即连续八个 sector组成一个 block。</p>
<p>文件数据都储存在”块”中，那么很显然，我们还必须找到一个地方储存文件的元信息，比如文件的创建者、文件的创建日期、文件的大小等等。这种储存文件元信息的区域就叫做inode，中文译名为”索引节点”。</p>
<p>二、inode的内容<br>inode包含文件的元信息，具体来说有以下内容：<br>　　<em> 文件的字节数
　　</em> 文件拥有者的User ID<br>　　<em> 文件的Group ID
　　</em> 文件的读、写、执行权限<br>　　<em> 文件的时间戳，共有三个：ctime指inode上一次变动的时间，mtime指文件内容上一次变动的时间，atime指文件上一次打开的时间。
　　</em> 链接数，即有多少文件名指向这个inode<br>　　* 文件数据block的位置</p>
<p>可以用stat命令，查看某个文件的inode信息：<br>stat example.txt</p>
<p>总之，除了文件名以外的所有文件信息，都存在inode之中。至于为什么没有文件名，下文会有详细解释。</p>
<p>三、inode的大小<br>inode也会消耗硬盘空间，所以硬盘格式化的时候，操作系统自动将硬盘分成两个区域。一个是数据区，存放文件数据；另一个是inode区（inode table），存放inode所包含的信息。<br>每个inode节点的大小，一般是128字节或256字节。inode节点的总数，在格式化时就给定，一般是每1KB或每2KB就设置一个inode。假定在一块1GB的硬盘中，每个inode节点的大小为128字节，每1KB就设置一个inode，那么inode table的大小就会达到128MB，占整块硬盘的12.8%。</p>
<p>查看每个硬盘分区的inode总数和已经使用的数量，可以使用df命令。<br>df -i<br>查看每个inode节点的大小，可以用如下命令：<br>sudo dumpe2fs -h /dev/hda | grep “Inode size”<br>由于每个文件都必须有一个inode，因此有可能发生inode已经用光，但是硬盘还未存满的情况。这时，就无法在硬盘上创建新文件。</p>
<p>四、inode号码<br>每个inode都有一个号码，操作系统用inode号码来识别不同的文件。</p>
<p>这里值得重复一遍，Unix/Linux系统内部不使用文件名，而使用inode号码来识别文件。对于系统来说，文件名只是inode号码便于识别的别称或者绰号。表面上，用户通过文件名，打开文件。实际上，系统内部这个过程分成三步：首先，系统找到这个文件名对应的inode号码；其次，通过inode号码，获取inode信息；最后，根据inode信息，找到文件数据所在的block，读出数据。</p>
<p>使用ls -i命令，可以看到文件名对应的inode号码：</p>
<p>ls -i example.txt</p>
<p>五、目录文件<br>Unix/Linux系统中，目录（directory）也是一种文件。打开目录，实际上就是打开目录文件。</p>
<p>目录文件的结构非常简单，就是一系列目录项（dirent）的列表。每个目录项，由两部分组成：所包含文件的文件名，以及该文件名对应的inode号码。</p>
<p>ls命令只列出目录文件中的所有文件名：<br>ls /etc<br>ls -i命令列出整个目录文件，即文件名和inode号码：<br>ls -i /etc<br>如果要查看文件的详细信息，就必须根据inode号码，访问inode节点，读取信息。ls -l命令列出文件的详细信息。<br>ls -l /etc</p>
<p>六、硬链接<br>一般情况下，文件名和inode号码是”一一对应”关系，每个inode号码对应一个文件名。但是，Unix/Linux系统允许，多个文件名指向同一个inode号码。这意味着，可以用不同的文件名访问同样的内容；对文件内容进行修改，会影响到所有文件名；但是，删除一个文件名，不影响另一个文件名的访问。这种情况就被称为”硬链接”（hard link）。</p>
<p>ln命令可以创建硬链接：</p>
<p>ln 源文件 目标文件<br>运行上面这条命令以后，源文件与目标文件的inode号码相同，都指向同一个inode。inode信息中有一项叫做”链接数”，记录指向该inode的文件名总数，这时就会增加1。反过来，删除一个文件名，就会使得inode节点中的”链接数”减1。当这个值减到0，表明没有文件名指向这个inode，系统就会回收这个inode号码，以及其所对应block区域。</p>
<p>这里顺便说一下目录文件的”链接数”。创建目录时，默认会生成两个目录项：”.”和”..”。前者的inode号码就是当前目录的inode号码，等同于当前目录的”硬链接”；后者的inode号码就是当前目录的父目录的inode号码，等同于父目录的”硬链接”。所以，任何一个目录的”硬链接”总数，总是等于2加上它的子目录总数（含隐藏目录）,这里的2是父目录对其的“硬链接”和当前目录下的”.硬链接“。</p>
<p>七、软链接<br>除了硬链接以外，还有一种特殊情况。文件A和文件B的inode号码虽然不一样，但是文件A的内容是文件B的路径。读取文件A时，系统会自动将访问者导向文件B。因此，无论打开哪一个文件，最终读取的都是文件B。这时，文件A就称为文件B的”软链接”（soft link）或者”符号链接（symbolic link）。</p>
<p>这意味着，文件A依赖于文件B而存在，如果删除了文件B，打开文件A就会报错：”No such file or directory”。这是软链接与硬链接最大的不同：文件A指向文件B的文件名，而不是文件B的inode号码，文件B的inode”链接数”不会因此发生变化。</p>
<p>ln -s命令可以创建软链接。<br>ln -s 源文文件或目录 目标文件或目录</p>
<p>八、inode的特殊作用<br>由于inode号码与文件名分离，这种机制导致了一些Unix/Linux系统特有的现象。<br>　　1. 有时，文件名包含特殊字符，无法正常删除。这时，直接删除inode节点，就能起到删除文件的作用。<br>　　2. 移动文件或重命名文件，只是改变文件名，不影响inode号码。<br>　　3. 打开一个文件以后，系统就以inode号码来识别这个文件，不再考虑文件名。因此，通常来说，系统无法从inode号码得知文件名。<br>      第3点使得软件更新变得简单，可以在不关闭软件的情况下进行更新，不需要重启。因为系统通过inode号码，识别运行中的文件，不通过文件名。更新的时候，新版文件以同样的文件名，生成一个新的inode，不会影响到运行中的文件。等到下一次运行这个软件的时候，文件名就自动指向新版文件，旧版文件的inode则被回收。</p>
<p>九 实际问题</p>
<p>在一台配置较低的Linux服务器（内存、硬盘比较小）的/data分区内创建文件时，系统提示磁盘空间不足，用df -h命令查看了一下磁盘使用情况，发现/data分区只使用了66%，还有12G的剩余空间，按理说不会出现这种问题。 后来用df -i查看了一下/data分区的索引节点(inode)，发现已经用满(IUsed=100%)，导致系统无法创建新目录和文件。 </p>
<p>查找原因：<br>　　/data/cache目录中存在数量非常多的小字节缓存文件，占用的Block不多，但是占用了大量的inode。 </p>
<p>解决方案：<br>　　1、删除/data/cache目录中的部分文件，释放出/data分区的一部分inode。<br>　　2、用软连接将空闲分区/opt中的newcache目录连接到/data/cache，使用/opt分区的inode来缓解/data分区inode不足的问题：<br>　　ln -s /opt/newcache /data/cache </p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/01/在linux怎样查看挂载情况/" itemprop="url">
                  在linux怎样查看挂载情况
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-06-01T00:38:27+08:00" content="2016-06-01">
              2016-06-01
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/系统/" itemprop="url" rel="index">
                    <span itemprop="name">系统</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/系统/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/01/在linux怎样查看挂载情况/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/01/在linux怎样查看挂载情况/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#10;cat /etc/mtab</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/09/php编译中遇到种种error解决办法/" itemprop="url">
                  php编译中遇到种种error解决办法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-05-09T00:31:41+08:00" content="2016-05-09">
              2016-05-09
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程语言/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/09/php编译中遇到种种error解决办法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/09/php编译中遇到种种error解决办法/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>1) Configure: error: xml2-config not found. Please check your libxml2 installation.<br>Solutions :<br>Quote:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#yum install libxml2 libxml2-devel (For Redhat &#38; Fedora)&#10;# aptitude install libxml2-dev      (For ubuntu)</span><br></pre></td></tr></table></figure></p>
<p>2) Checking for pkg-config… /usr/bin/pkg-config<br>configure: error: Cannot find OpenSSL’s <evp.h><br>Solutions :<br>Quote:</evp.h></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#yum install openssl openssl-devel</span><br></pre></td></tr></table></figure>
<p>3) Configure: error: Please reinstall the BZip2 distribution<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install bzip2 bzip2-devel</span><br></pre></td></tr></table></figure>
<p>4) Configure: error: Please reinstall the libcurl distribution -<br>easy.h should be in <curl-dir>/include/curl/<br>Solutions :<br>Quote:</curl-dir></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install curl curl-devel   (For Redhat &#38; Fedora)&#10;# install libcurl4-gnutls-dev    (For Ubuntu)</span><br></pre></td></tr></table></figure>
<p>5) Configure: error: libjpeg.(also) not found.<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install libjpeg libjpeg-devel</span><br></pre></td></tr></table></figure>
<p>6) Configure: error: libpng.(also) not found.<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install libpng libpng-devel</span><br></pre></td></tr></table></figure>
<p>7) Configure: error: freetype.h not found.<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#yum install freetype-devel</span><br></pre></td></tr></table></figure>
<p>8) Configure: error: Unable to locate gmp.h<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install gmp-devel</span><br></pre></td></tr></table></figure>
<p>9) Configure: error: Cannot find MySQL header files under /usr.<br>Note that the MySQL client library is not bundled anymore!<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install mysql-devel            (For Redhat &#38; Fedora)&#10;# apt-get install libmysql++-dev      (For Ubuntu)</span><br></pre></td></tr></table></figure>
<p>10) Configure: error: Please reinstall the ncurses distribution<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install ncurses ncurses-devel</span><br></pre></td></tr></table></figure>
<p>11) Checking for unixODBC support… configure: error: ODBC header file ‘/usr/include/sqlext.h’ not found!<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install unixODBC-devel</span><br></pre></td></tr></table></figure>
<p>12) Configure: error: Cannot find pspell<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install pspell-devel</span><br></pre></td></tr></table></figure>
<p>13) configure: error: mcrypt.h not found. Please reinstall libmcrypt.<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wget https://sourceforge.net/projects/mcrypt/files/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz/download&#10;mv download libmcrypt-2.5.8.tar.gz&#10;tar zxvf libmcrypt-2.5.8.tar.gz&#10;cd libmcrypt-2.5.8&#10;./configure --prefix=/usr/local/mcrypt&#10;make&#10;make install</span><br></pre></td></tr></table></figure>
<p>14) Configure: error: snmp.h not found. Check your SNMP installation.<br>Solutions :<br>Quote:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># yum install net-snmp net-snmp-devel</span><br></pre></td></tr></table></figure>
<p>15)configure: error: Please reinstall libmhash – I cannot find mhash.h</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#yum install mhash-devel</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/28/继承类并使用单例模式陷阱/" itemprop="url">
                  继承类并使用单例模式陷阱
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-03-28T00:46:51+08:00" content="2016-03-28">
              2016-03-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程语言/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/28/继承类并使用单例模式陷阱/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/28/继承类并使用单例模式陷阱/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="variable">$_instance</span> = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> !== <span class="keyword">static</span>::<span class="variable">$_instance</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">static</span>::<span class="variable">$_instance</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'init '</span>.get_called_class().<span class="string">";\r\n"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">static</span>::<span class="variable">$_instance</span> = <span class="keyword">new</span> <span class="keyword">static</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cls1st</span> <span class="keyword">extends</span> <span class="title">Base</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">say</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"1st;\r\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cls2nd</span> <span class="keyword">extends</span> <span class="title">Base</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">say</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"2nd;\r\n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cls1st</span> = Cls1st::getInstance();</span><br><span class="line"><span class="variable">$cls1st</span>-&gt;say();</span><br><span class="line"><span class="variable">$cls2nd</span> = Cls2nd::getInstance();</span><br><span class="line"><span class="variable">$cls2nd</span>-&gt;say();</span><br><span class="line"><span class="variable">$cls1st</span> = Cls1st::getInstance();</span><br><span class="line"><span class="variable">$cls1st</span>-&gt;say();</span><br><span class="line"><span class="variable">$cls2nd</span> = Cls2nd::getInstance();</span><br><span class="line"><span class="variable">$cls2nd</span>-&gt;say();</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#10;init Cls1st;&#10;1st;&#10;1st;&#10;1st;&#10;1st;</span><br></pre></td></tr></table></figure>
<p>修改父类</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="variable">$_instances</span> = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$calledClass</span> = get_called_class();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">static</span>::<span class="variable">$_instances</span>[<span class="variable">$calledClass</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">static</span>::<span class="variable">$_instances</span>[<span class="variable">$calledClass</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'init '</span>.get_called_class().<span class="string">";\r\n"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$return</span> = <span class="keyword">static</span>::<span class="variable">$_instances</span>[<span class="variable">$calledClass</span>] = <span class="keyword">new</span> <span class="keyword">static</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#10;init Cls1st;&#10;1st;&#10;init Cls2nd;&#10;2nd;&#10;1st;&#10;2nd;</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/20/GIT命令/" itemprop="url">
                  GIT命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-03-20T12:53:09+08:00" content="2016-03-20">
              2016-03-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/版本管理/" itemprop="url" rel="index">
                    <span itemprop="name">版本管理</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/版本管理/GIT/" itemprop="url" rel="index">
                    <span itemprop="name">GIT</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/20/GIT命令/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/20/GIT命令/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u7B80_u5355_u7406_u89E3_u547D_u4EE4"><a href="#u7B80_u5355_u7406_u89E3_u547D_u4EE4" class="headerlink" title="简单理解命令"></a>简单理解命令</h2><p><a href="http://zhuanlan.zhihu.com/FrontendMagazine/19845650" target="_blank" rel="external">http://zhuanlan.zhihu.com/FrontendMagazine/19845650</a></p>
<p><a href="http://www.open-open.com/lib/view/open1335879873983.html" target="_blank" rel="external">http://www.open-open.com/lib/view/open1335879873983.html</a></p>
<h2 id="u901F_u67E5"><a href="#u901F_u67E5" class="headerlink" title="速查"></a>速查</h2><p><a href="http://www.jb51.net/article/55442.htm" target="_blank" rel="external">http://www.jb51.net/article/55442.htm</a></p>
<p><a href="http://www.codeceo.com/article/git-command-guide.html" target="_blank" rel="external">http://www.codeceo.com/article/git-command-guide.html</a></p>
<p><a href="http://www.codeceo.com/article/git-command-list.html" target="_blank" rel="external">http://www.codeceo.com/article/git-command-list.html</a></p>
<h3 id="u521B_u5EFA_u7248_u672C_u5E93"><a href="#u521B_u5EFA_u7248_u672C_u5E93" class="headerlink" title="创建版本库"></a>创建版本库</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#10;git clone &#60;url&#62;                                           #&#20811;&#38534;&#36828;&#31243;&#30340;&#29256;&#26412;&#24211; &#10;git init                                                        #&#21021;&#22987;&#21270;&#26412;&#22320;&#29256;&#26412;&#24211; &#10;git checkout -b &#26412;&#22320;&#20998;&#25903;&#21517; &#36828;&#31243;&#20998;&#25903;&#21517;        #&#33719;&#21462;&#36828;&#31243;&#20998;&#25903;&#30340;&#20195;&#30721;</span><br></pre></td></tr></table></figure>
<h3 id="u4FEE_u6539_u548C_u63D0_u4EA4"><a href="#u4FEE_u6539_u548C_u63D0_u4EA4" class="headerlink" title="修改和提交"></a>修改和提交</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git status                                                   #&#26597;&#30475;&#29366;&#24577; &#10;git diff                                                      #&#26597;&#30475;&#21464;&#26356;&#20869;&#23481; &#10;git add                                                      #&#36319;&#36394;&#25152;&#26377;&#25913;&#21160;&#36807;&#30340;&#25991;&#20214; &#10;git add &#60;file&#62;                                           #&#36319;&#36394;&#25351;&#23450;&#30340;&#25991;&#20214; &#10;git mv &#60;old&#62; &#60;new&#62;                                #&#25991;&#20214;&#25913;&#21517; &#10;git rm &#60;file&#62;                                             #&#21024;&#38500;&#25991;&#20214; &#10;git rm --cached &#60;file&#62;                              #&#20572;&#27490;&#36319;&#36394;&#25991;&#20214;&#20294;&#19981;&#21024;&#38500; &#10;git commit -m &#34;commit message&#34;            #&#25552;&#20132;&#25152;&#26377;&#26356;&#26032;&#36807;&#30340;&#25991;&#20214; &#10;git commit --amend                                #&#20462;&#25913;&#26368;&#21518;&#19968;&#27425;&#25552;&#20132;</span><br></pre></td></tr></table></figure>
<h3 id="u67E5_u770B_u63D0_u4EA4_u5386_u53F2"><a href="#u67E5_u770B_u63D0_u4EA4_u5386_u53F2" class="headerlink" title="查看提交历史"></a>查看提交历史</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git log                                                    #&#26597;&#30475;&#25552;&#20132;&#30340;&#21382;&#21490; &#10;git log -p &#60;file&#62;                                     #&#26597;&#30475;&#25351;&#23450;&#25991;&#20214;&#30340;&#25552;&#20132;&#21382;&#21490; &#10;git blame &#60;file&#62;                                     #&#20197;&#21015;&#34920;&#26041;&#24335;&#26597;&#30475;&#25351;&#23450;&#25991;&#20214;&#30340;&#25552;&#20132;&#21382;&#21490;</span><br></pre></td></tr></table></figure>
<h3 id="u64A4_u6D88"><a href="#u64A4_u6D88" class="headerlink" title="撤消"></a>撤消</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#10;git reset --hard HEAD                          #&#25764;&#28040;&#24037;&#20316;&#30446;&#24405;&#20013;&#25152;&#26377;&#26410;&#25552;&#20132;&#25991;&#20214;&#30340;&#20462;&#25913;&#20869;&#23481; &#10;git checkout HEAD &#60;file&#62;                   #&#25764;&#28040;&#25351;&#23450;&#30340;&#26410;&#25552;&#20132;&#25991;&#20214;&#30340;&#20462;&#25913;&#20869;&#23481; &#10;git revert &#60;commit&#62;                           #&#25764;&#28040;&#25351;&#23450;&#30340;&#25552;&#20132;&#10;git reset --hard HEAD                         #&#25918;&#24323;&#26242;&#23384;&#21306;B&#21644;&#24037;&#20316;&#30446;&#24405;C&#30340;&#25152;&#26377;&#20462;&#25913;&#65292;&#24674;&#22797;&#26368;&#36817;&#19968;&#27425;&#25552;&#20132;&#29366;&#24577; &#65288;A -&#62;C &#25152;&#26377;&#25991;&#20214;) &#10;git checkout -- &#60;file_name&#62;              #&#24674;&#22797;&#26576;&#25991;&#20214;&#21040;&#26368;&#36817;&#19968;&#27425;&#25552;&#20132;&#29366;&#24577;&#65292;&#25918;&#24323;checkout&#21518;&#30340;&#20462;&#25913; (A -&#62; C &#25351;&#23450;&#25991;&#20214;) &#10;git revert HEAD                                 #&#25764;&#28040;&#26368;&#36817;&#30340;&#19968;&#20010;&#25552;&#20132; &#65288;&#38024;&#23545;&#24050;&#32463;&#30340;commit&#65292;&#36319;B&#21644;C&#26080;&#20851;&#65289; &#10;git revert HEAD^                              # &#25764;&#28040;&#19978;&#27425;&#8221;(next-to-last)&#30340;&#25552;&#20132; &#65288;^ &#20010;&#25968;&#21487;&#20197;&#36882;&#22686;&#65289;</span><br></pre></td></tr></table></figure>
<h3 id="u5206_u652F_u4E0E_u6807_u7B7E"><a href="#u5206_u652F_u4E0E_u6807_u7B7E" class="headerlink" title="分支与标签"></a>分支与标签</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git branch                                                     #&#26174;&#31034;&#25152;&#26377;&#26412;&#22320;&#20998;&#25903; &#10;git branch &#60;branchName&#62;                           #&#21019;&#24314;&#26032;&#20998;&#25903; &#10;git checkout &#60;branchName/tagName&#62;        #&#20999;&#25442;&#21040;&#25351;&#23450;&#20998;&#25903;&#25110;&#26631;&#31614; &#10;git checkout -b &#60;branchName&#62;                   #&#21019;&#24314;&#26032;&#20998;&#25903;&#24182;&#20999;&#25442;&#21040;&#35813;&#20998;&#25903;&#10;git branch -d &#60;branchName&#62;                      #&#21024;&#38500;&#26412;&#22320;&#20998;&#25903;&#10;git branch -D &#60;branchName&#62;                     #&#24378;&#21046;&#21024;&#38500;&#26412;&#22320;&#20998;&#25903; &#10;git tag                                                         #&#21015;&#20986;&#25152;&#26377;&#26412;&#22320;&#26631;&#31614; &#10;git tag &#60;tagname&#62;                                     #&#22522;&#20110;&#26368;&#26032;&#25552;&#20132;&#21019;&#24314;&#26631;&#31614; &#10;git tag -d &#60;tagname&#62;                                #&#21024;&#38500;&#26631;&#31614; &#10;&#10;git checkout [options] [&#60;branchName&#62;] -- &#60;file&#62;... #&#22797;&#21046;&#25991;&#20214;&#21040;&#25351;&#23450;&#20998;&#25903;&#10;git diff &#60;branch&#62; --stat                                           #&#27604;&#36739;branch&#20998;&#25903;&#19982;&#24403;&#21069;&#20998;&#25903;&#24046;&#24322;</span><br></pre></td></tr></table></figure>
<h3 id="u5408_u5E76_u4E0E_u884D_u5408"><a href="#u5408_u5E76_u4E0E_u884D_u5408" class="headerlink" title="合并与衍合"></a>合并与衍合</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git merge &#60;branch&#62;                       #&#21512;&#24182;&#25351;&#23450;&#20998;&#25903;&#21040;&#24403;&#21069;&#20998;&#25903; &#10;git rebase &#60;branch&#62;                      #&#34893;&#21512;&#25351;&#23450;&#20998;&#25903;&#21040;&#24403;&#21069;&#20998;&#25903;</span><br></pre></td></tr></table></figure>
<h3 id="u8FDC_u7A0B_u64CD_u4F5C"><a href="#u8FDC_u7A0B_u64CD_u4F5C" class="headerlink" title="远程操作"></a>远程操作</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git remote -v                                          #&#26597;&#30475;&#36828;&#31243;&#29256;&#26412;&#24211;&#20449;&#24687; &#10;git remote show &#60;remote&#62;                    #&#26597;&#30475;&#25351;&#23450;&#36828;&#31243;&#29256;&#26412;&#24211;&#20449;&#24687; &#10;git remote add &#60;remote&#62; &#60;url&#62;            #&#28155;&#21152;&#36828;&#31243;&#29256;&#26412;&#24211; &#10;git fetch &#60;remote&#62;                                #&#20174;&#36828;&#31243;&#24211;&#33719;&#21462;&#20195;&#30721; &#10;git pull &#60;remote&#62; &#60;branchName&#62;         #&#19979;&#36733;&#20195;&#30721;&#21450;&#24555;&#36895;&#21512;&#24182; &#10;git push &#60;remote&#62; &#60;branchName&#62;       #&#19978;&#20256;&#20195;&#30721;&#21450;&#24555;&#36895;&#21512;&#24182; &#10;git push &#60;remote&#62; : &#60;branchName/tag-name&#62;    #&#21024;&#38500;&#36828;&#31243;&#20998;&#25903;&#25110;&#26631;&#31614; &#10;git push --tag                           #&#19978;&#20256;&#25152;&#26377;&#26631;&#31614;&#10;git branch -r                            #&#26597;&#30475;&#36828;&#31243;&#20998;&#25903;&#10;&#10;&#10;git rm --cached readme.txt # &#25991;&#20214;&#25918;&#24323;&#36319;&#36394;&#65292;&#20294;&#26159;&#36824;&#26159;&#20445;&#30041;&#22312;&#24037;&#20316;&#30446;&#24405;&#20013;&#12290; &#27809;&#26377;--cached &#36873;&#39033;&#65292;&#23601;&#23436;&#20840;&#21024;&#38500;&#25991;&#20214; &#10;git rm filename            #&#30452;&#25509;&#21024;&#38500;&#25991;&#20214;&#10;&#36890;&#36807;&#8220;git rm --cached README.txt&#8221;&#21629;&#20196;&#65292;&#21487;&#20197;&#23558;&#25991;&#20214;&#29366;&#24577;&#36824;&#21407;&#20026;&#26410;&#26242;&#23384;&#29366;&#24577;&#65292;&#21363;&#22238;&#21040;&#8220;Untracked files&#8221;&#25991;&#20214;&#29366;&#24577;&#12290; &#10;&#36890;&#36807;&#8220;git add README.txt&#8221;&#21629;&#20196;&#23558;&#24050;&#20462;&#25913;&#25991;&#20214;&#26356;&#26032;&#21040;&#26242;&#23384;&#21306;&#22495;&#20013;&#65292;&#22914;&#26524;&#24819;&#25764;&#38144;&#20462;&#25913;&#65292;&#21487;&#20197;&#20351;&#29992;&#8220;git checkout -- README.txt&#8221;&#21629;&#20196;&#12290; &#10;&#36890;&#36807;git reset HEAD &#60;file&#62;&#21462;&#28040;&#26242;&#23384;</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/20/GIT-SSH-keys/" itemprop="url">
                  GIT SSH keys
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-03-20T12:45:04+08:00" content="2016-03-20">
              2016-03-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/版本管理/" itemprop="url" rel="index">
                    <span itemprop="name">版本管理</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/版本管理/GIT/" itemprop="url" rel="index">
                    <span itemprop="name">GIT</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/20/GIT-SSH-keys/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/20/GIT-SSH-keys/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>生成key</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &#34;tomhjx&#34;</span><br></pre></td></tr></table></figure>
<p>查key内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat ~/.ssh/id_rsa.pub</span><br></pre></td></tr></table></figure>
            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/12/定时器重启爱奇艺客户端/" itemprop="url">
                  定时器重启爱奇艺客户端
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-03-12T01:34:42+08:00" content="2016-03-12">
              2016-03-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程语言/" itemprop="url" rel="index">
                    <span itemprop="name">编程语言</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程语言/windows批处理/" itemprop="url" rel="index">
                    <span itemprop="name">windows批处理</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/12/定时器重启爱奇艺客户端/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/12/定时器重启爱奇艺客户端/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u80CC_u666F"><a href="#u80CC_u666F" class="headerlink" title="背景"></a>背景</h2><p>想下载几个电视节目，找了很多地方，没有资源打包下载的，只有爱奇艺上可以下载。</p>
<p>但是有个问题，爱奇艺客户端上的下载功能不好用，断了不重试，每次断了之后，只能手动暂停再重开才能继续。</p>
<p>于是需要写个批处理来代替人工，才能挂着不用管。</p>
<h2 id="u7CFB_u7EDF"><a href="#u7CFB_u7EDF" class="headerlink" title="系统"></a>系统</h2><p>windows xp sp3</p>
<h2 id="u65B9_u6848"><a href="#u65B9_u6848" class="headerlink" title="方案"></a>方案</h2><ul>
<li><p>由于无法长时间挂着下载，需要定期暂停并重新下载</p>
</li>
<li><p>设置客户端启动即刻继续下载</p>
</li>
<li><p>定时重启客户端，达到周期性重试下载的目的</p>
</li>
</ul>
<h2 id="u8BBE_u8BA1"><a href="#u8BBE_u8BA1" class="headerlink" title="设计"></a>设计</h2><h5 id="u5BA2_u6237_u7AEF_u7684_u5B88_u62A4_u8FDB_u7A0B"><a href="#u5BA2_u6237_u7AEF_u7684_u5B88_u62A4_u8FDB_u7A0B" class="headerlink" title="客户端的守护进程"></a>客户端的守护进程</h5><ul>
<li><p>设置客户端自动启动</p>
</li>
<li><p><code>运行</code> -&gt; 输入<code>msconfig</code> -&gt; 切换到<code>启动</code>选项卡 </p>
</li>
<li><p>找到最小启动客户端的命令</p>
</li>
</ul>
<ul>
<li>编写客户端的守护进程</li>
</ul>
<p><code>QyClient-daemon.bat</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#10;:main&#10;ping -n 3 127.0.0.1&#62;nul&#10;tasklist | find /i &#34;QyClient.exe&#34;&#38;&#38;goto main&#10;cd D:\Program Files\IQIYI Video\LStyle\&#10;start QyClient.exe&#10;goto main</span><br></pre></td></tr></table></figure>
<h5 id="u5173_u95ED_u5BA2_u6237_u7AEF"><a href="#u5173_u95ED_u5BA2_u6237_u7AEF" class="headerlink" title="关闭客户端"></a>关闭客户端</h5><p><code>QyClient-Close.bat</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">taskkill /im QyClient.exe</span><br></pre></td></tr></table></figure>
<h5 id="u4E3B_u8FDB_u7A0B"><a href="#u4E3B_u8FDB_u7A0B" class="headerlink" title="主进程"></a>主进程</h5><p><code>QyClient.bat</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd D:\workplace\tmp\&#10;start /min QyClient-daemon.bat&#10;:main&#10;ping -n 71 127.0.0.1&#62;nul&#10;taskkill /im QyClient.exe&#10;goto main</span><br></pre></td></tr></table></figure>
<h2 id="u4F7F_u7528"><a href="#u4F7F_u7528" class="headerlink" title="使用"></a>使用</h2><p>执行<code>QyClient.bat</code></p>
<h2 id="git"><a href="#git" class="headerlink" title="git"></a>git</h2><p><a href="https://github.com/tomhjx/tools/tree/master/qiyi-download" target="_blank" rel="external">https://github.com/tomhjx/tools/tree/master/qiyi-download</a></p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/03/MySQL行级锁-表级锁-页级锁详解/" itemprop="url">
                  MySQL行级锁,表级锁,页级锁详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-03T18:02:00+08:00" content="2016-01-03">
              2016-01-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据库/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/03/MySQL行级锁-表级锁-页级锁详解/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/03/MySQL行级锁-表级锁-页级锁详解/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h2 id="u884C_u7EA7_u9501_2C_u8868_u7EA7_u9501_2C_u9875_u7EA7_u9501"><a href="#u884C_u7EA7_u9501_2C_u8868_u7EA7_u9501_2C_u9875_u7EA7_u9501" class="headerlink" title="行级锁,表级锁,页级锁"></a>行级锁,表级锁,页级锁</h2><p>页级:引擎 BDB。<br>表级:引擎 MyISAM ， 理解为锁住整个表，可以同时读，写不行<br>行级:引擎 INNODB ， 单独的一行记录加锁</p>
<p>表级，直接锁定整张表，在你锁定期间，其它进程无法对该表进行写操作。如果你是写锁，则其它进程则读也不允许<br>行级,，仅对指定的记录进行加锁，这样其它进程还是可以对同一个表中的其它记录进行操作。<br>页级，表级锁速度快，但冲突多，行级冲突少，但速度慢。所以取了折衷的页级，一次锁定相邻的一组记录。 </p>
<p>MySQL 5.1支持对MyISAM和MEMORY表进行表级锁定，对BDB表进行页级锁定，对InnoDB表进行行级锁定。<br>对WRITE，MySQL使用的表锁定方法原理如下：<br>如果在表上没有锁，在它上面放一个写锁。<br>否则，把锁定请求放在写锁定队列中。 </p>
<p>对READ，MySQL使用的锁定方法原理如下：<br>如果在表上没有写锁定，把一个读锁定放在它上面<br>否则，把锁请求放在读锁定队列中。 </p>
<p>InnoDB使用行锁定，BDB使用页锁定。对于这两种存储引擎，都可能存在死锁。这是因为，在SQL语句处理期间，InnoDB自动获得行锁定和BDB获得页锁定，而不是在事务启动时获得。  </p>
<p>行级锁定的优点：</p>
<ul>
<li>当在许多线程中访问不同的行时只存在少量锁定冲突。</li>
<li>回滚时只有少量的更改。</li>
<li>可以长时间锁定单一的行。</li>
</ul>
<p>行级锁定的缺点：</p>
<ul>
<li>比页级或表级锁定占用更多的内存。</li>
<li>当在表的大部分中使用时，比页级或表级锁定速度慢，因为你必须获取更多的锁。</li>
<li>如果你在大部分数据上经常进行GROUP BY操作或者必须经常扫描整个表，比其它锁定明显慢很多。</li>
<li>用高级别锁定，通过支持不同的类型锁定，你也可以很容易地调节应用程序，因为其锁成本小于行级锁定。</li>
</ul>
<p>在以下情况下，表锁定优先于页级或行级锁定：</p>
<ul>
<li>表的大部分语句用于读取。</li>
<li>对严格的关键字进行读取和更新，你可以更新或删除可以用单一的读取的关键字来提取的一行：</li>
<li>UPDATE tbl_name SET column=value WHERE unique_key_col=key_value;</li>
<li>DELETE FROM tbl_name WHERE unique_key_col=key_value;</li>
<li>SELECT 结合并行的INSERT语句，并且只有很少的UPDATE或DELETE语句。</li>
<li>在整个表上有许多扫描或GROUP BY操作，没有任何写操作。</li>
</ul>
<h2 id="mysql__u9501_u8868_u7C7B_u578B_u548C_u89E3_u9501_u8BED_u53E5"><a href="#mysql__u9501_u8868_u7C7B_u578B_u548C_u89E3_u9501_u8BED_u53E5" class="headerlink" title="mysql 锁表类型和解锁语句"></a>mysql 锁表类型和解锁语句</h2><p>如果想要在一个表上做大量的 INSERT 和 SELECT 操作，但是并行的插入却不可能时，可以将记录插入到临时表中，然后定期将临时表中的数据更新到实际的表里。可以用以下命令实现：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; LOCK TABLES real_table WRITE, insert_table WRITE;</span><br><span class="line">mysql&gt; INSERT INTO real_table SELECT * FROM insert_table;</span><br><span class="line">mysql&gt; TRUNCATE TABLE insert_table;</span><br><span class="line">mysql&gt; UNLOCK TABLES;</span><br></pre></td></tr></table></figure>
<p>行级锁的优点有：<br>    在很多线程请求不同记录时减少冲突锁。<br>    事务回滚时减少改变数据。<br>    使长时间对单独的一行记录加锁成为可能。</p>
<p>行级锁的缺点有：<br>    比页级锁和表级锁消耗更多的内存。<br>    锁是计算机协调多个进程或线程并发访问某一资源的机制，不同的数据库的锁机制大同小异。由于数据库资源是一种供许多用户共享的资源，所以如何保证数据并发访问的一致性、有效性是所有数据库必须解决的一个问题，锁冲突也是影响数据库并发访问性能的一个重要因素。了解锁机制不仅可以使我们更有效的开发利用数据库资源，也使我们能够更好地维护数据库，从而提高数据库的性能。</p>
<p>MySQL的锁机制比较简单，其最显著的特点是不同的存储引擎支持不同的锁机制。</p>
<p>例如，MyISAM和MEMORY存储引擎采用的是表级锁（table-level-locking）；BDB存储引擎采用的是页面锁（page-level-locking），同时也支持表级锁；InnoDB存储引擎既支持行级锁，也支持表级锁，默认情况下是采用行级锁。</p>
<p>上述三种锁的特性可大致归纳如下：<br>1） 表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。<br>2） 行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。<br>3） 页面锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般。</p>
<pre><code>三种锁各有各的特点，若仅从锁的角度来说，表级锁更适合于以查询为主，只有少量按索引条件更新数据的应用，如WEB应用；行级锁更适合于有大量按索引条件并发更新少量不同数据，同时又有并发查询的应用，如一些在线事务处理（OLTP）系统。

MySQL表级锁有两种模式：表共享读锁（Table Read Lock）和表独占写锁（Table Write Lock）。什么意思呢，就是说对MyISAM表进行读操作时，它不会阻塞其他用户对同一表的读请求，但会阻塞 对同一表的写操作；而对MyISAM表的写操作，则会阻塞其他用户对同一表的读和写操作。

MyISAM表的读和写是串行的，即在进行读操作时不能进行写操作，反之也是一样。但在一定条件下MyISAM表也支持查询和插入的操作的并发进行，其机制是通过控制一个系统变量（concurrent_insert）来进行的，当其值设置为0时，不允许并发插入；当其值设置为1 时，如果MyISAM表中没有空洞（即表中没有被删除的行），MyISAM允许在一个进程读表的同时，另一个进程从表尾插入记录；当其值设置为2时，无论MyISAM表中有没有空洞，都允许在表尾并发插入记录。

MyISAM锁调度是如何实现的呢，这也是一个很关键的问题。例如，当一个进程请求某个MyISAM表的读锁，同时另一个进程也请求同一表的写锁，此时MySQL将会如优先处理进程呢？通过研究表明，写进程将先获得锁（即使读请求先到锁等待队列）。但这也造成一个很大的缺陷，即大量的写操作会造成查询操作很难获得读锁，从而可能造成永远阻塞。所幸我们可以通过一些设置来调节MyISAM的调度行为。我们可通过指定参数low-priority-updates，使MyISAM默认引擎给予读请求以优先的权利，设置其值为1（set low_priority_updates=1),使优先级降低。

InnoDB锁与MyISAM锁的最大不同在于：一是支持事务（TRANCSACTION），二是采用了行级锁。我们知道事务是由一组SQL语句组成的逻辑处理单元，其有四个属性（简称ACID属性），分别为：
</code></pre><p>原子性（Atomicity）：事务是一个原子操作单元，其对数据的修改，要么全部执行，要么全都不执行；<br>一致性（Consistent）：在事务开始和完成时，数据都必须保持一致状态；<br>隔离性（Isolation）：数据库系统提供一定的隔离机制，保证事务在不受外部并发操作影响的“独立”环境执行；<br>持久性（Durable）：事务完成之后，它对于数据的修改是永久性的，即使出现系统故障也能够保持。</p>
<p>InnoDB有两种模式的行锁：</p>
<p>1）共享锁：允许一个事务去读一行，阻止其他事务获得相同数据集的排他锁。<br>    ( Select * from table_name where ……lock in share mode)</p>
<p>2）排他锁：允许获得排他锁的事务更新数据，阻止其他事务取得相同数据集的共享读锁和  排他写锁。(select * from table_name where…..for update)<br>    为了允许行锁和表锁共存，实现多粒度锁机制；同时还有两种内部使用的意向锁（都是表锁），分别为意向共享锁和意向排他锁。<br>    InnoDB行锁是通过给索引项加锁来实现的，即只有通过索引条件检索数据，InnoDB才使用行级锁，否则将使用表锁！</p>
<p>另外：插入，更新性能优化的几个重要参数</p>
<p>bulk_insert_buffer_size<br>批量插入缓存大小, 这个参数是针对MyISAM存储引擎来说的.适用于在一次性插入100-1000+条记录时, 提高效率.默认值是8M.可以针对数据量的大小,翻倍增加.</p>
<p>concurrent_insert<br>并发插入, 当表没有空洞(删除过记录), 在某进程获取读锁的情况下,其他进程可以在表尾部进行插入.</p>
<p>值可以设0不允许并发插入, 1当表没有空洞时, 执行并发插入, 2不管是否有空洞都执行并发插入.<br>默认是1 针对表的删除频率来设置.</p>
<p>delay_key_write<br>针对MyISAM存储引擎,延迟更新索引.意思是说,update记录时,先将数据up到磁盘,但不up索引,将索引存在内存里,当表关闭时,将内存索引,写到磁盘. 值为 0不开启, 1开启. 默认开启.</p>
<p>delayed_insert_limit, delayed_insert_timeout, delayed_queue_size<br>延迟插入, 将数据先交给内存队列, 然后慢慢地插入.但是这些配置,不是所有的存储引擎都支持, 目前来看, 常用的InnoDB不支持, MyISAM支持. 根据实际情况调大, 一般默认够用了</p>
<h2 id="MySQL_InnoDB__u9501_u8868_u4E0E_u9501_u884C"><a href="#MySQL_InnoDB__u9501_u8868_u4E0E_u9501_u884C" class="headerlink" title="MySQL InnoDB 锁表与锁行"></a>MySQL InnoDB 锁表与锁行</h2><p>由于InnoDB预设是Row-Level Lock，所以只有「明确」的指定主键，MySQL才会执行Row lock (只锁住被选取的资料例) ，否则MySQL将会执行Table Lock (将整个资料表单给锁住)。</p>
<p>举个例子: 假设有个表单products ，里面有id跟name二个栏位，id是主键。</p>
<p>例1: (明确指定主键，并且有此笔资料，row lock)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">'3'</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">'3'</span> <span class="keyword">and</span> <span class="keyword">type</span>=<span class="number">1</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span></span><br></pre></td></tr></table></figure>
<p>例2: (明确指定主键，若查无此笔资料，无lock)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">'-1'</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span></span><br></pre></td></tr></table></figure>
<p>例3: (无主键，table lock)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> <span class="keyword">name</span>=<span class="string">'Mouse'</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span></span><br></pre></td></tr></table></figure>
<p>例4: (主键不明确，table lock)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> <span class="keyword">id</span>&lt;&gt;<span class="string">'3'</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span></span><br></pre></td></tr></table></figure>
<p>例5: (主键不明确，table lock)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">LIKE</span> <span class="string">'3'</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span></span><br></pre></td></tr></table></figure>
<p>注1: FOR UPDATE仅适用于InnoDB，且必须在交易区块(BEGIN/COMMIT)中才能生效。<br>注2: 要测试锁定的状况，可以利用MySQL的Command Mode ，开二个视窗来做测试。</p>
<p>在MySql 5.0中测试确实是这样的<br>另外：MyAsim 只支持表级锁，InnerDB支持行级锁<br>添加了(行级锁/表级锁)锁的数据不能被其它事务再锁定，也不被其它事务修改（修改、删除）<br>是表级锁时，不管是否查询到记录，都会锁定表<br>此外，如果A与B都对表id进行查询但查询不到记录，则A与B在查询上不会进行row锁，但A与B都会获取排它锁，此时A再插入一条记录的话则会因为B已经有锁而处于等待中，此时B再插入一条同样的数据则会抛出Deadlock found when trying to get lock; try restarting transaction然后释放锁，此时A就获得了锁而插入成功</p>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/03/MYSQL索引失效的各种情形总结/" itemprop="url">
                  MYSQL索引失效的各种情形总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-03T17:58:30+08:00" content="2016-01-03">
              2016-01-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp; 分类于
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/数据库/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/01/03/MYSQL索引失效的各种情形总结/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/03/MYSQL索引失效的各种情形总结/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <ul>
<li>没有查询条件，或者查询条件没有建立索引 </li>
<li>在查询条件上没有使用引导列 </li>
<li>查询的数量是大表的大部分，应该是30％以上。 </li>
<li>索引本身失效</li>
<li>查询条件使用函数在索引列上，或者对索引列进行运算，运算包括(+，-，<em>，/，! 等) 错误的例子：select </em> from test where id-1=9; 正确的例子：select * from test where id=10; </li>
<li>对小表查询 </li>
<li>提示不使用索引</li>
<li>统计数据不真实 </li>
<li>CBO计算走索引花费过大的情况。其实也包含了上面的情况，这里指的是表占有的block要比索引小。 </li>
<li>隐式转换导致索引失效.这一点应当引起重视.也是开发中经常会犯的错误. 由于表的字段tu_mdn定义为varchar2(20),但在查询时把该字段作为number类型以where条件传给Oracle,这样会导致索引失效. 错误的例子：select <em> from test where tu_mdn=13333333333; 正确的例子：select </em> from test where tu_mdn=’13333333333’; </li>
<li>&lt;&gt;  </li>
<li>like “%_” 百分号在前. </li>
<li>表没分析. </li>
<li>单独引用复合索引里非第一位置的索引列. </li>
<li>字符型字段为数字时在where条件里不添加引号. </li>
<li>对索引列进行运算.需要建立函数索引. </li>
<li>not in ,not exist. </li>
<li>当变量采用的是times变量，而表的字段采用的是date变量时.或相反情况。 </li>
<li>B-tree索引 is null不会走,is not null会走,位图索引 is null,is not null 都会走 </li>
<li>联合索引 is not null 只要在建立的索引列（不分先后）都会走, in null时 必须要和建立索引第一列一起使用,当建立索引第一位置条件是is null 时,其他建立索引的列可以是is null（但必须在所有列 都满足is null的时候）,或者=一个值； 当建立索引的第一位置是=一个值时,其他索引列可以是任何情况（包括is null =一个值）,以上两种情况索引都会走。其他情况不会走。</li>
</ul>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.jpg" alt="疯狂的茶几" itemprop="image"/>
          <p class="site-author-name" itemprop="name">疯狂的茶几</p>
        </div>
        <p class="site-description motion-element" itemprop="description">懒人一个</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">21</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">12</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">17</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">疯狂的茶几</span>
</div>




      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"tomhjx"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
